<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Para mi esposa 1 Mes</title>
  <audio src="Media/music.mp3" id="music" style="display: none;"></audio>
  <style>
    :root{
      --bg1:#FFE9B5; /* warm sky */
      --bg2:#BFE6A9; /* green hills */
      --accent:#F6C25E;
      --card-bg: rgba(255,255,255,0.95);
      --soft-shadow: 0 10px 30px rgba(17,24,39,0.12);
      font-family: 'Georgia', 'Times New Roman', serif;
      color:#1b1b1b;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1) 0%, #F7D8A1 40%, #C8E6B0 100%);}
    .app{height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}

    /* Scenes container */
    .scene{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;transition:opacity 1s ease,filter 1s ease;}
    .hidden{opacity:0;pointer-events:none;filter:blur(4px) saturate(.9);}

    /* Scene 1 styles */
    #scene1{background:linear-gradient(180deg,#fff3d9 0%, #dff0d6 100%);} 
    #sunflower-canvas{position:absolute;inset:0;width:100%;height:100%;z-index:0}

    .card-wrap{position:relative;z-index:3;display:flex;align-items:center;justify-content:center;padding:20px}
    .letter-card{
      width:min(760px,90vw);min-height:220px;padding:28px 36px;border-radius:18px;background:var(--card-bg);box-shadow:var(--soft-shadow);backdrop-filter: blur(6px);position:relative;overflow:visible
    }
    .letter-text{font-size:20px;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;min-height:120px}
    .emojis{position:absolute;inset:0;pointer-events:none;z-index:2}
    .emoji{position:absolute;font-size:28px;opacity:0;transform:translateY(0) scale(.6);transition:transform 900ms cubic-bezier(.2,.9,.2,1),opacity 900ms}

    /* typing cursor */
    .cursor{display:inline-block;width:10px;height:22px;background:#222;vertical-align:middle;margin-left:6px;border-radius:3px;animation:blink 1s steps(2) infinite}
    @keyframes blink{50%{opacity:0}}

    /* small controls */
    .controls{position:fixed;right:18px;bottom:18px;z-index:10}
    .btn{background:#fff;padding:10px 14px;border-radius:10px;box-shadow:var(--soft-shadow);border:0;cursor:pointer}

    /* Fade overlay for transitions */
    .fade-overlay{position:absolute;inset:0;background:rgba(255,255,255,0);pointer-events:none;z-index:5;transition:background 1s}

    /* Scene 2 styles */
    #scene2{background:linear-gradient(180deg,#EAD7FF 0%, #E9F7E6 100%);}
    .sunflower-stage{display:flex;flex-direction:column;align-items:center;gap:18px}
    .big-sunflower{width:min(560px,86vw);height:min(560px,86vw);position:relative}
    .instruction{font-size:18px}

    /* modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:40;opacity:0;pointer-events:none;transition:opacity .25s}
    .modal.open{opacity:1;pointer-events:auto}
    .modal-content{width:min(900px,94vw);background:#000;border-radius:12px;padding:8px}
    video{width:100%;height:auto;border-radius:8px;display:block}

    /* responsive */
    @media (max-width:600px){.letter-text{font-size:16px}.emoji{font-size:22px}}
  </style>
</head>
<body>
<div class="app">
  <!-- Scene 1 -->
  <section id="scene1" class="scene">
    <canvas id="sunflower-canvas"></canvas>
    <div class="card-wrap">
      <div class="letter-card" aria-live="polite">
        <div id="letter" class="letter-text"></div>
        <span id="cursor" class="cursor" style="position: absolute; top: -1000px;" aria-hidden="true"></span>
        <div class="emojis" id="emoji-container"></div>
      </div>
    </div>
    <div class="fade-overlay" id="fade1"></div>
  </section>

  <!-- Scene 2 -->
  <section id="scene2" class="scene hidden">
    <div class="sunflower-stage">
      <div class="instruction">Toca un p√©talo para ver un video ‚Üí</div>
      <div class="big-sunflower" id="big-sunflower">
        <!-- SVG sunflower inserted by JS -->
      </div>
    </div>
  </section>

  <!-- Modal for video -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button id="modal-close" class="btn" style="float:right;margin:6px;">Cerrar</button>
      <!-- Replace src="your-video.mp4" with your file or URL. -->
      <video id="modal-video" controls preload="metadata" src="your-video.mp4"></video>
    </div>
  </div>

  <div class="controls">
    <button id="skip-btn" class="btn"></button>
  </div>
</div>

<script>
/* ------------------------------
   Configurable content
   ------------------------------*/
const LETTER_TEXT = `Hola mi amor,

Te escribo esta carta porque quiero decirte lo mucho que te amo, lo mucho que te aprecio, lo que te admiro y lo orgulloso que estoy de vos, amor. Me encanta todo, absolutamente todo de vos.

√öltimamente hemos tenido bonitos y hermosos momentos juntos, pero tambi√©n hemos vivido momentos dif√≠ciles, donde pensamos que esto se iba a derrumbar, donde cre√≠mos que ya no ten√≠a caso seguir intent√°ndolo. Pero el amor que nos tenemos nos impuls√≥ a seguir luchando, a ser pacientes, a soportar, y esa es una clara muestra de que nuestro amor es real. Nuestro amor no solo est√° cuando todo est√° bien; est√° en las buenas, en las malas, en las mejores y en las peores.

Hemos soportado que incluso nuestra propia familia haya intentado separarnos, pero nosotros lo hemos solucionado, lo hemos afrontado y lo hemos hecho de la mejor manera, amor. Hemos aprendido a sobrellevar nuestras actitudes, que a veces chocan, pero aun as√≠, el amor que nos tenemos ha permitido que sigamos juntos.

Amor, gracias. Gracias porque siempre me has tenido paciencia por todas las cosas que han pasado, porque siempre lo has seguido intentando igual que yo. A pesar de los problemas, t√∫ siempre est√°s ah√≠. S√© que hay momentos en los que todo nos abruma, nos cansa, nos agota, pero t√∫, mi amor, siempre est√°s a mi lado. Y eso lo valoro con todo mi coraz√≥n. Me encanta eso de vos, mi amor. 

Yo s√© que muy pronto vamos a poder cumplir nuestras metas, que muy pronto vamos a vivir juntos en nuestra casa y hacer todo lo que hemos so√±ado: cocinar juntos, convivir juntos, disfrutar de cada detalle y seguir construyendo nuestra historia llena de amor.

Quiero decirte que este mes fue uno de los mejores que he tenido, porque tuve a la esposa m√°s linda, m√°s cari√±osa, la que me apoya en todo, la que me hace sentir querido, amado y que hace de todo para que yo est√© bien. Recuerdo ese d√≠a que llegu√© a tu casa. Nunca hab√≠a llegado, pero me sent√≠ como si ya viviera ah√≠, como si ya fuera parte de esa casa. Me sent√≠ en casa con tu familia, y sobre todo me encant√≥ c√≥mo me trataste, c√≥mo te portaste conmigo. Eso me lleg√≥ al coraz√≥n. Ver eso me termin√≥ de demostrar cu√°nto me amas, igual que yo te amo. Yo te amo mucho, te amo y te seguir√© amando por siempre.

√öltimamente me has preguntado y has tenido inseguridades sobre si alg√∫n d√≠a, cuando nuestro f√≠sico cambie, yo voy a dejar de sentir lo que siento por vos ahora, y eso no va a pasar jam√°s. Yo a usted la quiero para mi esposa, para siempre. A m√≠ no me importa el f√≠sico, no me importa que sea mayor; cuando ya est√© viejita, a m√≠ no me importa, yo la voy a seguir tratando igual, igual que ahora, igual que siempre. Porque jam√°s se me van a quitar esos ojos de amor que yo le tengo a usted. Yo quiero un futuro, un futuro maravilloso con usted, que cumplamos nuestras metas, que cumplamos todo lo que hemos deseado.

Recuerdo ese d√≠a que fuimos a la asamblea. Yo estaba muy nervioso, pero me puse as√≠ porque ah√≠ estaba mi princesa, que aunque no √©ramos nada en ese entonces, ya ten√≠amos una gran relaci√≥n, casi de un a√±o conversando todos los d√≠as. Eso no era normal. Siempre ha habido algo que nos ha conectado: la computaci√≥n, tus gustos, mis gustos. Pero yo desde que te vi en Zoom, cuando estabas peque√±a, siempre quise que fueras mi novia. Siempre, siempre me gustaste. Y mir√° ahora: qui√©n dir√≠a que ser√≠as mi esposa, que sos mi esposa, y que vas a ser la futura madre de mis hijos.

Solo quiero decirte que este mes es el comienzo de un mundo y de un largo trayecto que nos espera. Prometo estar contigo de la mano, siempre. No te voy a soltar, pase lo que pase. Ya sea que todo el mundo lo odie, nosotros odiaremos al mundo y seguiremos los dos nuestro camino. Porque eso es lo que importa; no importa lo dem√°s, solo importamos nosotros, y afrontaremos cada problema que tengamos juntos.

As√≠ que amor, gracias por este mes tan lindo que hemos tenido, y por los que faltan. Y despu√©s no solo vamos a celebrar meses, vamos a celebrar a√±os, cuando ya estemos casados. Bueno, ya estamos casados, pero legalmente mi amor. 

Bueno... feliz primer mes de novios, mi amoooor. Te amo mucho.`;

// NOTE: Replace the <video> src attribute in HTML or set it dynamically here.

/* ------------------------------
   Simple soft typing sound (WebAudio)
   ------------------------------*/
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function playTypeSound(){
  if(!audioCtx) audioCtx = new AudioContext();
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.setValueAtTime(1000, now);
  g.gain.setValueAtTime(0.0015, now);
  g.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(now); o.stop(now + 0.09);
}

/* ------------------------------
   Typing animation & emojis
   ------------------------------*/
const letterEl = document.getElementById('letter');
const cursor = document.getElementById('cursor');
const emojiContainer = document.getElementById('emoji-container');
const skipBtn = document.getElementById('skip-btn');
let typingIndex = 0; let typingInterval = null;
const TYPING_SPEED = 28; // ms per char (adjust)
function startTyping() {
  cursor.style.display='none'
  if (typeof typingInterval !== 'undefined' && typingInterval) {
    clearInterval(typingInterval);
    typingInterval = null;
  }

  letterEl.textContent = '';
  cursor.style.display = 'inline-block';
  typingIndex = 0;

  const paragraphs = LETTER_TEXT.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
  let currentParagraph = 0;

  function typeParagraph(text, done) {
    letterEl.textContent = '';
    cursor.style.display = 'inline-block';
    let index = 0;
    clearInterval(typingInterval);

    // Para animaci√≥n de altura del cuadro
    const updateHeight = () => {
      letterEl.style.transition = 'height 0.3s ease';
      letterEl.style.height = letterEl.scrollHeight + 'px';
    };
    updateHeight();

    typingInterval = setInterval(() => {
      if (index >= text.length) {
        clearInterval(typingInterval);
        cursor.style.display = 'none';
        if (done) done();
        return;
      }

      const ch = text[index++];
      letterEl.textContent += ch;
      playTypeSound();

      if (Math.random() < 0.05) spawnEmoji();

      // Ajusta altura durante la escritura
      updateHeight();

      // efecto leve en cursor
      cursor.style.opacity = (index % 2 === 0) ? 1 : 0.4;
    }, 40);
  }

  function showParagraph(index) {
    if (index >= paragraphs.length) {
      endScene1();
      return;
    }
let active = false;
    // Escribe el p√°rrafo actual
    typeParagraph(paragraphs[index], () => {
      // Espera clic para continuar
      document.addEventListener('click', ()=> {advanceOnce(); if(!active) {document.getElementById('music').play(); active = true} }, { once: true });
      document.addEventListener('touchstart', advanceOnce, { once: true });
    });
  }

  function advanceOnce() {
    currentParagraph++;
    if (currentParagraph < paragraphs.length) {
      showParagraph(currentParagraph);
    } else {
      endScene1();
    }
  }

  // Ajuste inicial del contenedor
  letterEl.style.display = 'inline-block';
  letterEl.style.overflow = 'hidden';
  letterEl.style.transition = 'height 0.3s ease';
  letterEl.style.height = 'auto';

  // Inicia con el primer p√°rrafo
  showParagraph(currentParagraph);
}


function spawnEmoji(){
  const EMOJIS = ['‚ù§Ô∏è','üåª','üíå','‚ú®','ü•∞','üå§Ô∏è'];
  const e = document.createElement('div'); e.className='emoji'; e.innerText = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
  const cardRect = document.querySelector('.letter-card').getBoundingClientRect();
  // position random around card but not over text: place around edges
  const side = Math.random();
  let x = Math.random()*cardRect.width, y;
  if(side < 0.33){ y = -20 - Math.random()*20; } // top
  else if(side < 0.66){ y = cardRect.height + 10 + Math.random()*40; } // bottom
  else { y = Math.random()*(cardRect.height-20)+10; if(Math.random()<0.5) x = -30 - Math.random()*20; else x = cardRect.width + 10 + Math.random()*40; }
  e.style.left = x + 'px'; e.style.top = y + 'px';
  emojiContainer.appendChild(e);
  // show
  requestAnimationFrame(()=>{ e.style.opacity = 1; e.style.transform = `translateY(${Math.random()*-60-10}px) scale(1)`; });
  // float away and remove
  setTimeout(()=>{ e.style.opacity = 0; e.style.transform = `translateY(${Math.random()*-140-80}px) scale(.6)`; setTimeout(()=>e.remove(),900); }, 2200 + Math.random()*1600);
}

/* ------------------------------
   Scene transition
   ------------------------------*/
const scene1 = document.getElementById('scene1');
const scene2 = document.getElementById('scene2');
const fade1 = document.getElementById('fade1');
let transitioned = false;
function endScene1() {
  if (transitioned) return;
  transitioned = true;
  fade1.style.background = 'rgba(255,255,255,1)';

  setTimeout(() => {
    // Redirige al nuevo archivo en la misma ruta
    window.location.href = 'scene2.html';
  }, 900); // mantiene el peque√±o retraso de transici√≥n
}

skipBtn.addEventListener('click', ()=>{
  clearInterval(typingInterval); cursor.style.display='none'; endScene1();
});

/* ------------------------------
   Sunflowers background (scene1) - canvas
   ------------------------------*/
const canvas = document.getElementById('sunflower-canvas');
const ctx = canvas.getContext('2d');
let DPR = window.devicePixelRatio || 1;
let sunflowers = [];

function resizeCanvas(){
  DPR = window.devicePixelRatio || 1;
  canvas.width = Math.floor(window.innerWidth * DPR);
  canvas.height = Math.floor(window.innerHeight * DPR);
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}

class SmallSunflower{
  constructor(x,y,scale){this.x=x;this.y=y;this.scale=scale;this.phase=Math.random()*Math.PI*2;this.sway=0;}
  draw(t){
    const sway = Math.sin(t/800 + this.phase)*6*this.scale;
    const stemH = 80*this.scale;
    const stemW = 4*this.scale;
    ctx.save();
    ctx.translate(this.x,this.y);
    // stem
    ctx.beginPath(); ctx.moveTo(0,0); ctx.quadraticCurveTo(sway/2, stemH/2, sway, stemH); ctx.lineWidth = stemW; ctx.strokeStyle = '#2c7a2c'; ctx.stroke();
    // leaves
    ctx.beginPath(); ctx.ellipse(sway/3, stemH*0.5, 12*this.scale,6*this.scale, Math.sin(t/300+this.phase)/6,0,Math.PI*2); ctx.fillStyle='#3aa13a'; ctx.fill();
    // flower head
    ctx.save(); ctx.translate(sway, -10*this.scale);
    const petalCount = 12; const petalR = 18*this.scale; const centerR = 10*this.scale;
    for(let i=0;i<petalCount;i++){
      const a = i*(Math.PI*2/petalCount);
      ctx.beginPath(); ctx.ellipse(Math.cos(a)*petalR, Math.sin(a)*petalR, petalR*0.9, petalR*0.45, a+0.2, 0, Math.PI*2);
      ctx.fillStyle = '#FFD46A'; ctx.fill();
    }
    ctx.beginPath(); ctx.arc(0,0,centerR,0,Math.PI*2); ctx.fillStyle='#8a5b2b'; ctx.fill();
    ctx.restore();
    ctx.restore();
  }
}

function populateSunflowers(){
  sunflowers = [];
  const cols = Math.max(6, Math.floor(window.innerWidth/120));
  for(let i=0;i<cols;i++){
    const x = (i+0.5)*(window.innerWidth/cols) + (Math.random()*60-30);
    const y = window.innerHeight - (20 + Math.random()*140);
    const s = 0.8 + Math.random()*0.7; sunflowers.push(new SmallSunflower(x,y,s));
  }
}

function animateBackground(t){
  if(scene1.classList.contains('hidden')) return; // stop drawing when hidden
  ctx.clearRect(0,0,canvas.width/DPR,canvas.height/DPR);
  // draw hills
  const h = window.innerHeight;
  const g = ctx.createLinearGradient(0,h*0.4,0,h);
  g.addColorStop(0,'#C6F0A6'); g.addColorStop(1,'#8ECB61');
  ctx.fillStyle = g; ctx.beginPath(); ctx.moveTo(0,h); ctx.quadraticCurveTo(window.innerWidth*0.25,h*0.75,window.innerWidth*0.5,h*0.85); ctx.quadraticCurveTo(window.innerWidth*0.75,h*0.95,window.innerWidth,h); ctx.lineTo(window.innerWidth, h); ctx.lineTo(0,h); ctx.fill();
  // sky subtle
  ctx.globalAlpha = 0.75; ctx.fillStyle = 'rgba(255,255,255,0.05)'; ctx.fillRect(0,0,window.innerWidth,window.innerHeight*0.5); ctx.globalAlpha = 1;
  // draw sun
  ctx.beginPath(); ctx.arc(window.innerWidth*0.12, window.innerHeight*0.16, 48, 0, Math.PI*2); ctx.fillStyle = 'rgba(255,230,140,0.95)'; ctx.fill();
  // sunflowers
  for(const s of sunflowers) s.draw(t);
  requestAnimationFrame(animateBackground);
}

/* ------------------------------
   Scene 2: big sunflower (SVG) and petals interaction
   ------------------------------*/
const bigSunflowerContainer = document.getElementById('big-sunflower');
let petalCount = 10; let petalEls = [];

function initBigSunflower(){
  // Build an SVG with petals that are clickable
  bigSunflowerContainer.innerHTML = '';
  const size = Math.min(560, Math.max(360, window.innerWidth*0.7));
  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS,'svg'); svg.setAttribute('width',size); svg.setAttribute('height',size); svg.setAttribute('viewBox',`-200 -200 400 400`);
  // center circle
  const center = document.createElementNS(svgNS,'circle'); center.setAttribute('r',50); center.setAttribute('fill','#8a5b2b'); svg.appendChild(center);
  // build petals
  petalEls = [];
  for(let i=0;i<petalCount;i++){
    const a = i*(Math.PI*2/petalCount);
    const petal = document.createElementNS(svgNS,'path');
    // a simple petal path created using an arc-like bezier
    const px = Math.cos(a)*110; const py = Math.sin(a)*110;
    const bx1 = Math.cos(a-0.25)*40; const by1 = Math.sin(a-0.25)*40;
    const bx2 = Math.cos(a+0.25)*40; const by2 = Math.sin(a+0.25)*40;
    const d = `M 0 0 C ${bx1} ${by1} ${px} ${py} ${px*1.05} ${py*1.05} C ${px*0.6} ${py*0.6} ${bx2} ${by2} 0 0 Z`;
    petal.setAttribute('d', d); petal.setAttribute('fill','#FFD46A'); petal.setAttribute('stroke','#E6B85A'); petal.setAttribute('stroke-width','1'); petal.setAttribute('data-index',i);
    petal.style.transition = 'transform .35s cubic-bezier(.2,.9,.2,1)';
    petal.style.transformOrigin = '0px 0px';
    svg.appendChild(petal);
    petalEls.push(petal);
  }
  // center overlay (heart)
  const heart = document.createElementNS(svgNS,'text'); heart.setAttribute('x',-12); heart.setAttribute('y',8); heart.setAttribute('font-size','36'); heart.setAttribute('fill','#fff'); heart.textContent = 'üíõ'; svg.appendChild(heart);
  bigSunflowerContainer.appendChild(svg);
  // animate petals breathing
  let start = performance.now();
  function breathe(now){
    const dt = now - start;
    petalEls.forEach((p,idx)=>{
      const phase = Math.sin(dt/900 + idx);
      const s = 1 + phase*0.02;
      p.style.transform = `scale(${s}) rotate(${phase*3}deg)`;
    });
    if(!scene2.classList.contains('hidden')) requestAnimationFrame(breathe);
  }
  requestAnimationFrame(breathe);

  // click handlers
  petalEls.forEach(p=>{
    p.style.cursor = 'pointer';
    p.addEventListener('click', ()=>openPetalModal(p));
  });
}

/* ------------------------------
   Petal -> open modal with video
   ------------------------------*/
const modal = document.getElementById('modal');
const modalVideo = document.getElementById('modal-video');
const modalClose = document.getElementById('modal-close');
let activePetal = null;

function openPetalModal(petal){
  if(activePetal) return; activePetal = petal;
  // animate petal out (scale and translate slightly)
  petal.style.transform += ' translateZ(0) translate(14px,-8px) scale(1.05)';
  // open modal
  modal.classList.add('open');
  // if user hasn't replaced the video src, you can set it here dynamically
  // modalVideo.src = 'your-video.mp4';
  setTimeout(()=>{ modalVideo.play().catch(()=>{}); }, 300);
}

function closeModal(){
  modal.classList.remove('open');
  try{ modalVideo.pause(); modalVideo.currentTime = 0; }catch(e){}
  // return petal position (reset transform)
  if(activePetal){ activePetal.style.transform = ''; activePetal = null; }
}
modalClose.addEventListener('click', closeModal);
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

/* ------------------------------
   Init
   ------------------------------*/
window.addEventListener('resize', ()=>{ resizeCanvas(); populateSunflowers(); });
resizeCanvas(); populateSunflowers(); requestAnimationFrame(animateBackground);

// wait for first user interaction to enable audio context in some browsers
window.addEventListener('pointerdown', function once(){ startTyping(); window.removeEventListener('pointerdown', once); }, {once:true});
// fallback: start typing after small delay if no interaction
setTimeout(()=>{}, 1600);
// startTyping()
startTyping()
setInterval(()=> spawnEmoji(),100)
</script>
</body>
</html>
